<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>รายการอนิเมะ - ANIME XD</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://img5.pic.in.th">
</head>
<body>

  <!-- เมนู -->
  <header>
    <button id="menuToggle" aria-label="เปิดเมนู">☰</button>
    <nav id="navMenu" class="hidden">
      <ul>
        <li><a href="/">หน้าแรก</a></li>
        <li><a href="/anime">รายการอนิเมะ</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>รายการอนิเมะ</h1>

    <!-- ช่องค้นหา -->
    <input type="text" id="searchInput" placeholder="ค้นหาอนิเมะ..." />

    <!-- กริดรายการ -->
    <div id="animeGrid" class="grid"></div>

    <!-- ข้อความถ้าไม่พบผลลัพธ์ -->
    <p id="noResults" style="display: none;">ไม่พบผลลัพธ์</p>

    <!-- ปุ่มเปลี่ยนหน้า -->
    <div class="pagination">
      <button id="prevBtn">ก่อนหน้า</button>
      <button id="nextBtn">ถัดไป</button>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 ANIME XD</p>
  </footer>

  <!-- โหลดข้อมูลจาก anime-data.js -->
  <script src="anime-data.js" defer></script>

  <!-- สคริปต์หลัก -->
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const menuToggle = document.getElementById('menuToggle');
      const navMenu = document.getElementById('navMenu');
      const animeGrid = document.getElementById('animeGrid');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const searchInput = document.getElementById('searchInput');
      const noResults = document.getElementById('noResults');

      if (!animeList || !animeGrid || !prevBtn || !nextBtn || !searchInput || !noResults) return;

      const itemsPerPage = 20;
      let currentPage = 1;
      let filteredList = animeList;

      // ใส่ meta noindex ถ้าไม่ใช่หน้าแรก
      function handleNoIndexMeta(page) {
        if (page > 1) {
          const meta = document.createElement("meta");
          meta.name = "robots";
          meta.content = "noindex";
          document.head.appendChild(meta);
        }
      }

      function renderPage(page) {
        animeGrid.innerHTML = '';
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageItems = filteredList.slice(start, end);

        noResults.style.display = pageItems.length === 0 ? 'block' : 'none';

        pageItems.forEach(anime => {
          const card = document.createElement('div');
          card.className = 'anime-card';
          card.innerHTML = `
            <a href="${anime.link}" target="_blank" rel="noopener noreferrer">
              <img src="${anime.img}" alt="${anime.title}" loading="lazy" width="200" height="280" />
              <div class="anime-info">
                <div class="anime-title">${anime.title}</div>
                <div class="anime-ep">${anime.type}</div>
              </div>
            </a>
          `;
          animeGrid.appendChild(card);
        });

        prevBtn.disabled = (page === 1);
        nextBtn.disabled = (page >= Math.ceil(filteredList.length / itemsPerPage));

        handleNoIndexMeta(page); // ✅ ใส่ noindex ถ้าไม่ใช่หน้าแรก
      }

      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderPage(currentPage);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });

      nextBtn.addEventListener('click', () => {
        if (currentPage < Math.ceil(filteredList.length / itemsPerPage)) {
          currentPage++;
          renderPage(currentPage);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });

      searchInput.addEventListener('input', () => {
        const query = searchInput.value.trim().toLowerCase();
        currentPage = 1;
        filteredList = query === ''
          ? animeList
          : animeList.filter(anime => anime.title.toLowerCase().includes(query));
        renderPage(currentPage);
      });

      if (menuToggle && navMenu) {
        menuToggle.addEventListener('click', () => navMenu.classList.toggle('active'));
        menuToggle.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            navMenu.classList.toggle('active');
          }
        });
      }

      renderPage(currentPage);
    });
  </script>

</body>
</html>
